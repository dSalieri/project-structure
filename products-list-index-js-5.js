(window.webpackJsonp=window.webpackJsonp||[]).push([[5],[,,,,function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return h}));var n=s(12),i=s(11);var r=[{id:"images",title:"Image",sortable:!1,template:(e=[])=>`\n        <div class="sortable-table__cell">\n          <img class="sortable-table-image" alt="Image" src="${e[0]&&e[0].url}">\n        </div>\n      `},{id:"title",title:"Name",sortable:!0,sortType:"string"},{id:"subcategory",title:"Category",sortable:!1,template:({category:{title:e},title:t}={})=>`\n        <div class="sortable-table__cell">\n          <span data-tooltip="${`\n        <div class='sortable-table-tooltip'>\n          <span class='sortable-table-tooltip__category'>${e}</span> /\n          <b class='sortable-table-tooltip__subcategory'>${t}</b>\n        </div>\n      `}">${t}</span>\n        </div>\n      `},{id:"quantity",title:"Quantity",sortable:!0,sortType:"number"},{id:"price",title:"Price",sortable:!0,sortType:"number",template:e=>`<div class="sortable-table__cell">${Object(i.a)(e)}$</div>`},{id:"status",title:"Status",sortable:!0,sortType:"number",template:e=>`<div class="sortable-table__cell">\n          ${e>0?"Active":"Inactive"}\n        </div>`}],a=s(15);function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class l{constructor({min:e=100,max:t=200,formatValue:s=(e=>"$"+e),selected:n={from:e,to:t}}={}){o(this,"element",void 0),o(this,"subElements",{}),o(this,"onThumbPointerMove",e=>{e.preventDefault();const{left:t,right:s,width:n}=this.subElements.inner.getBoundingClientRect();if(this.dragging===this.subElements.thumbLeft){let s=(e.clientX-t+this.shiftX)/n;s<0&&(s=0),s*=100;const i=parseFloat(this.subElements.thumbRight.style.right);s+i>100&&(s=100-i),this.dragging.style.left=this.subElements.progress.style.left=s+"%",this.subElements.from.innerHTML=this.formatValue(this.getValue().from)}if(this.dragging===this.subElements.thumbRight){let t=(s-e.clientX-this.shiftX)/n;t<0&&(t=0),t*=100;const i=parseFloat(this.subElements.thumbLeft.style.left);i+t>100&&(t=100-i),this.dragging.style.right=this.subElements.progress.style.right=t+"%",this.subElements.to.innerHTML=this.formatValue(this.getValue().to)}}),o(this,"onThumbPointerUp",()=>{this.element.classList.remove("range-slider_dragging"),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp),this.element.dispatchEvent(new CustomEvent("range-select",{detail:this.getValue(),bubbles:!0}))}),this.min=e,this.max=t,this.formatValue=s,this.selected=n,this.render()}get template(){const{from:e,to:t}=this.selected;return`<div class="range-slider">\n      <span data-element="from">${this.formatValue(e)}</span>\n      <div data-element="inner" class="range-slider__inner">\n        <span data-element="progress" class="range-slider__progress"></span>\n        <span data-element="thumbLeft" class="range-slider__thumb-left"></span>\n        <span data-element="thumbRight" class="range-slider__thumb-right"></span>\n      </div>\n      <span data-element="to">${this.formatValue(t)}</span>\n    </div>`}render(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild,this.element.ondragstart=()=>!1,this.subElements=this.getSubElements(e),this.initEventListeners(),this.update()}initEventListeners(){const{thumbLeft:e,thumbRight:t}=this.subElements;e.addEventListener("pointerdown",e=>this.onThumbPointerDown(e)),t.addEventListener("pointerdown",e=>this.onThumbPointerDown(e))}getSubElements(e){const t={},s=e.querySelectorAll("[data-element]");for(const e of s){t[e.dataset.element]=e}return t}remove(){this.element.remove()}destroy(){this.remove(),document.removeEventListener("pointermove",this.onThumbPointerMove),document.removeEventListener("pointerup",this.onThumbPointerUp)}update(){const e=this.max-this.min,t=Math.floor((this.selected.from-this.min)/e*100)+"%",s=Math.floor((this.max-this.selected.to)/e*100)+"%";this.subElements.progress.style.left=t,this.subElements.progress.style.right=s,this.subElements.thumbLeft.style.left=t,this.subElements.thumbRight.style.right=s}onThumbPointerDown(e){const t=e.target;e.preventDefault();const{left:s,right:n}=t.getBoundingClientRect();t===this.subElements.thumbLeft?this.shiftX=n-e.clientX:this.shiftX=s-e.clientX,this.dragging=t,this.element.classList.add("range-slider_dragging"),document.addEventListener("pointermove",this.onThumbPointerMove),document.addEventListener("pointerup",this.onThumbPointerUp)}getValue(){const e=this.max-this.min,{left:t}=this.subElements.thumbLeft.style,{right:s}=this.subElements.thumbRight.style;return{from:Math.round(this.min+.01*parseFloat(t)*e),to:Math.round(this.max-.01*parseFloat(s)*e)}}}function d(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class h{constructor(){d(this,"element",void 0),d(this,"subElements",{}),d(this,"components",{}),d(this,"url",new URL("api/rest/products","https://course-js.javascript.ru/")),d(this,"onInputThrottled",function(e,t){let s,n=0;return function(i){0===n&&e(i),clearTimeout(s),s=setTimeout((function(){n>1&&e(i),n=0}),t),n++}}(e=>{this.changeParamsURL.call(this.components.productsContainer,"title_like",e.target.value),this.updateComponents()},1e3)),d(this,"onSliderChange",e=>{this.changeParamsURL.call(this.components.productsContainer,"price_gte",e.detail.from),this.changeParamsURL.call(this.components.productsContainer,"price_lte",e.detail.to),this.updateComponents()}),d(this,"onOptionChange",e=>{const t=e.target.value;this.changeParamsURL.call(this.components.productsContainer,"status",""===t?null:t),this.updateComponents()})}async updateComponents(){this.components.productsContainer.start=0,this.components.productsContainer.end=30,this.components.productsContainer.update()}changeParamsURL(e,t){null==t?this.url.searchParams.delete(e):this.url.searchParams.set(e,t)}initComponents(){const e=new n.a(r,{url:this.url+"?_embed=subcategory.category",sorted:{id:"title",order:"asc"},start:0,step:30,isSortLocally:!1,scrollLoad:!0,rowTemplate:(e,t)=>`<a href="/products/${t.id}" class="sortable-table__row">${e}</a>`}),t=new l({min:0,max:4e3}),s=new a.a;s.initialize(),this.components={productsContainer:e,sliderContainer:t,tooltip:s}}renderComponents(){Object.keys(this.components).forEach(e=>{const t=this.subElements[e],{element:s}=this.components[e];s&&t.append(s)})}get template(){return'\n      <div class="products-list">\n        <div class="content__top-panel">\n          <h1 class="page-title">Products</h1>\n          <a href="/products/add" class="button-primary">Add product</a>\n        </div>\n        <div class="content-box content-box_small">\n          <form data-element="form" class="form-inline">\n            <div class="form-group">\n              <label class="form-label">Sort by:</label>\n              <input type="text" data-element="filterName" class="form-control" placeholder="Name product">\n            </div>\n            <div class="form-group" data-element="sliderContainer">\n              <label class="form-label">Price:</label>\n              \x3c!-- double-slider component --\x3e\n            </div>\n            <div class="form-group">\n              <label class="form-label">Status:</label>\n              <select class="form-control" data-element="filterStatus">\n                <option value="" selected="">Any</option>\n                <option value="1">Active</option>\n                <option value="0">Inactive</option>\n              </select>\n            </div>\n          </form>\n        </div>\n        <div data-element="productsContainer" class="products-list__container">\n          \x3c!-- sortable-table component --\x3e\n        </div>\n      </div>\n    '}render(){const e=document.createElement("div");return e.innerHTML=this.template,this.element=e.firstElementChild,this.subElements=this.getSubElements(this.element),this.initComponents(),this.renderComponents(),this.initEventListeners(),this.element}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}initEventListeners(){this.subElements.filterName.addEventListener("input",this.onInputThrottled),this.subElements.sliderContainer.addEventListener("range-select",this.onSliderChange),this.subElements.filterStatus.addEventListener("change",this.onOptionChange)}remove(){this.element&&this.element.remove()}destroy(){this.remove();for(const e of Object.values(this.components))e.destroy()}}},,,,,function(e,t,s){"use strict";var n=s(10);t.a=async function(e,t){let s,n;try{s=await fetch(e.toString(),t)}catch(e){throw new i(s,"Network error has occurred.")}if(!s.ok){let e=s.statusText;try{n=await s.json(),e=n.error&&n.error.message||n.data&&n.data.error&&n.data.error.message||e}catch(e){}let t=`Error ${s.status}: ${e}`;throw new i(s,n,t)}try{return await s.json()}catch(e){throw new i(s,null,e.message)}};class i extends Error{constructor(e,t,s){var n,i,r;super(s),r="FetchError",(i="name")in(n=this)?Object.defineProperty(n,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[i]=r,this.response=e,this.body=t}}window.addEventListener("unhandledrejection",e=>{if(e.reason instanceof i){new n.a(e.reason.message,{duration:3e3,type:"error"}).show()}})},function(e,t,s){"use strict";function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,"a",(function(){return i}));class i{constructor(e,{duration:t=1e3,type:s="success"}={}){n(this,"element",void 0),this.message=e,this.duration=t,this.type=s,this.createElement()}get template(){return`\n      <div class="notification notification_${this.type}" style="--value:${this.duration/1e3}s">\n        <div class="notification__content notification__content_show">\n            ${this.message}\n        </div>\n      </div>\n    `}createElement(){const e=document.createElement("div");e.innerHTML=this.template,this.element=e.firstElementChild}show(e=document.body){i.activeMessage&&i.activeMessage.remove(),e.append(this.element),this.timerId=setTimeout(()=>{this.remove()},this.duration),i.activeMessage=this}remove(){clearTimeout(this.timerId),this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,i.activeMessage=null}}n(i,"activeMessage",void 0)},function(e,t,s){"use strict";function n(e){return e=String(e),[...e].reverse().reduce((t,s,n)=>(t.push(s),(n+1)%3==0&&n<e.length-1&&t.push(","),t),[]).reverse().join("")}s.d(t,"a",(function(){return n}))},function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(9);function i(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class r{constructor(e=[],{url:t="",sorted:s={id:e.find(e=>e.sortable).id,order:"asc"},isSortLocally:n=!1,scrollLoad:r=!0,rowTemplate:a=(e=>`<div class="sortable-table__row">${e}</div>`),step:o=20,start:l=0,end:d=l+o}={}){i(this,"element",void 0),i(this,"subElements",{}),i(this,"data",[]),i(this,"loading",!1),i(this,"isLoaded",void 0),i(this,"componentIsLoaded",new Promise(e=>{this.isLoaded=e})),i(this,"onWindowScroll",async()=>{const{bottom:e}=this.element.getBoundingClientRect(),{id:t,order:s}=this.sorted;if(e<document.documentElement.clientHeight&&!this.loading){this.loading=!0,this.start=this.end,this.end=this.start+this.step;const e=await this.loadData(t,s,this.start,this.end);this.addRows(e),this.loading=!1}}),i(this,"onSortClick",e=>{const t=e.target.closest('[data-sortable="true"]');if(t){const{id:e,order:s}=t.dataset,n=(e=>({asc:"desc",desc:"asc"}[e]))(s);this.sorted={id:e,order:n},t.dataset.order=n,t.append(this.subElements.arrow),this.isSortLocally?this.sortOnClient(e,n):this.sortOnServer(e,n)}}),this.headersConfig=e,this.url=new URL(t,"https://course-js.javascript.ru"),this.sorted=s,this.isSortLocally=n,this.scrollLoad=r,this.rowTemplate=a,this.step=o,this.start=l,this.end=d,this.render()}async render(){const{id:e,order:t}=this.sorted,s=document.createElement("div");s.innerHTML=this.getTable();const n=s.firstElementChild;this.element=n,this.subElements=this.getSubElements(n);const i=await this.loadData(e,t,this.start,this.end);this.renderRows(i),this.isLoaded(),this.initEventListeners()}async loadData(e,t,s=this.start,i=this.end){this.url.searchParams.set("_sort",e),this.url.searchParams.set("_order",t),this.url.searchParams.set("_start",s),this.url.searchParams.set("_end",i),this.element.classList.add("sortable-table_loading");const r=await Object(n.a)(this.url);return this.element.classList.remove("sortable-table_loading"),r}async update(e){if(this.subElements.body.innerHTML="","function"==typeof e)this.element.classList.add("sortable-table_loading"),this.data=await e(),this.element.classList.remove("sortable-table_loading");else{let{id:t=this.sorted.id,order:s=this.sorted.order,start:n=this.start,end:i=this.end}=e||{};this.data=await this.loadData(t,s,n,i)}this.data.length?this.element.classList.remove("sortable-table_empty"):this.element.classList.add("sortable-table_empty"),this.subElements.body.innerHTML=this.getTableRows(this.data)}addRows(e){const t=document.createElement("div");this.data=[...this.data,...e],t.innerHTML=this.getTableRows(e),this.subElements.body.append(...t.childNodes)}getTableHeader(){return`<div data-element="header" class="sortable-table__header sortable-table__row">\n      ${this.headersConfig.map(e=>this.getHeaderRow(e)).join("")}\n    </div>`}getHeaderRow({id:e,title:t,sortable:s}){return`\n      <div class="sortable-table__cell" data-id="${e}" data-sortable="${s}" data-order="${this.sorted.id===e?this.sorted.order:"asc"}">\n        <span>${t}</span>\n        ${this.getHeaderSortingArrow(e)}\n      </div>\n    `}getHeaderSortingArrow(e){return(this.sorted.id===e?this.sorted.order:"")?'<span data-element="arrow" class="sortable-table__sort-arrow">\n          <span class="sort-arrow"></span>\n        </span>':""}getTableBody(e){return`\n      <div data-element="body" class="sortable-table__body">\n        ${this.getTableRows(e)}\n      </div>`}getTableRows(e){return e.map(e=>this.rowTemplate(this.getTableRow(e),e)).join("")}getTableRow(e){return this.headersConfig.map(({id:e,template:t})=>({id:e,template:t})).map(({id:t,template:s})=>s?s(e[t]):`<div class="sortable-table__cell">${e[t]}</div>`).join("")}getTable(){return`\n      <div class="sortable-table">\n        ${this.getTableHeader()}\n        ${this.getTableBody(this.data)}\n        <div data-element="loading" class="loading-line sortable-table__loading-line"></div>\n        <div data-element="emptyPlaceholder" class="sortable-table__empty-placeholder">\n          No products\n        </div>\n      </div>`}initEventListeners(){this.subElements.header.addEventListener("pointerdown",this.onSortClick),this.scrollLoad&&document.addEventListener("scroll",this.onWindowScroll)}sortOnClient(e,t){const s=this.sortData(e,t);this.subElements.body.innerHTML=this.getTableRows(s)}async sortOnServer(e,t){this.start=0,this.end=this.start+this.step,this.subElements.body.innerHTML="";const s=await this.loadData(e,t,this.start,this.end);this.renderRows(s)}renderRows(e){e.length?(this.element.classList.remove("sortable-table_empty"),this.addRows(e)):this.element.classList.add("sortable-table_empty")}sortData(e,t){const s=[...this.data],n=this.headersConfig.find(t=>t.id===e),{sortType:i,customSorting:r}=n,a="asc"===t?1:-1;return s.sort((t,s)=>{switch(i){case"number":return a*(t[e]-s[e]);case"string":return a*t[e].localeCompare(s[e],"ru");case"custom":return a*r(t,s);default:return a*(t[e]-s[e])}})}getSubElements(e){return[...e.querySelectorAll("[data-element]")].reduce((e,t)=>(e[t.dataset.element]=t,e),{})}remove(){this.element.remove()}destroy(){this.remove(),this.subElements={},document.removeEventListener("scroll",this.onWindowScroll)}}},,,function(e,t,s){"use strict";function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class i{constructor(){return n(this,"element",void 0),n(this,"moveHandler",e=>{this.element.style.left=e.clientX+10+"px",this.element.style.top=e.clientY+10+"px"}),n(this,"overHandler",e=>{const t=e.target.closest("[data-tooltip]");t&&(this.render(t.dataset.tooltip),document.addEventListener("pointermove",this.moveHandler))}),n(this,"outHandler",()=>{this.remove(),document.removeEventListener("pointermove",this.moveHandler)}),i.instance||(i.instance=this),i.instance}render(e){this.element=document.createElement("div"),this.element.className="tooltip",this.element.innerHTML=e,document.body.append(this.element)}initialize(){document.addEventListener("pointerover",this.overHandler),document.addEventListener("pointerout",this.outHandler)}remove(){this.element&&this.element.remove()}destroy(){this.remove(),this.element=null,i.instance=null,document.removeEventListener("pointerover",this.overHandler),document.removeEventListener("pointerout",this.outHandler),document.removeEventListener("pointermove",this.moveHandler)}}n(i,"instance",null),t.a=i}]]);
//# sourceMappingURL=products-list-index-js-5.js.map