{"version":3,"sources":["webpack:///./src/components/notification/index.js","webpack:///./src/components/sortable-list/index.js","webpack:///./src/components/categories/index.js","webpack:///./src/pages/categories/index.js","webpack:///./src/utils/fetch-json.js"],"names":["NotificationMessage","constructor","message","duration","type","this","createElement","wrapper","document","innerHTML","template","element","firstElementChild","show","target","body","activeMessage","remove","append","timerId","setTimeout","clearTimeout","destroy","SortableList","items","shiftDragging","top","left","posPlaceholder","posDragging","initialIndex","activeIndex","isScrolling","getTranslationDragging","dragging","placeholder","draggingBox","getBoundingClientRect","placeholderBox","draggingElem","documentElement","scrollTop","scrollLeft","placeholderElem","elementDragging","_props","topCondition","belowCondition","clientHeight","offsetHeight","window","scrollBy","requestAnimationFrame","scrollIfCloseToWindowEdge","event","closest","preventDefault","width","tWidth","height","tHeight","tTop","tLeft","clientY","clientX","elementPlaceholder","style","cssText","replaceWith","classList","add","pTop","pLeft","getIndex","addEventListener","onDragMove","onDragEnd","transformValue","position","zIndex","transform","transition","removeEventListener","onTransitionEnd","toggleEvent","CustomEvent","detail","changed","bubbles","dispatchEvent","display","familiarContainer","elementFromPoint","underElement","contains","after","before","removeAttribute","children","findIndex","item","render","sortList","createHTMLElement","forEach","addEventListeners","html","onRemoveItem","onDragStart","Categories","urls","templates","id","title","row","count","eventsList","onToggle","toggle","Promise","resolve","isLoaded","dataList","querySelectorAll","map","index","dataset","weight","save","events","getList","data","root","itemsList","subcategories","getItem","sortableList","querySelector","elements","fetchJson","URL","categories","category","url","result","method","headers","JSON","stringify","e","console","error","eventString","Error","onToggleData","Page","initComponents","components","renderComponents","Object","keys","component","subElements","getSubElements","initEventListeners","reduce","acc","subElement","Notification","values","params","response","fetch","toString","err","FetchError","ok","errorText","statusText","json","status","super","reason"],"mappings":"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","file":"categories-index-js-1.js","sourcesContent":["export default class NotificationMessage {\r\n  static activeMessage;\r\n  element;\r\n\r\n  constructor(message, { duration = 1000, type = \"success\" } = {}) {\r\n    this.message = message;\r\n    this.duration = duration;\r\n    this.type = type;\r\n    this.createElement();\r\n  }\r\n  get template() {\r\n    return /*html*/ `\r\n      <div class=\"notification notification_${this.type}\" style=\"--value:${\r\n      this.duration / 1000\r\n    }s\">\r\n        <div class=\"notification__content notification__content_show\">\r\n            ${this.message}\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n  createElement() {\r\n    const wrapper = document.createElement(\"div\");\r\n    wrapper.innerHTML = this.template;\r\n    this.element = wrapper.firstElementChild;\r\n  }\r\n  show(target = document.body) {\r\n    if (NotificationMessage.activeMessage)\r\n      NotificationMessage.activeMessage.remove();\r\n\r\n    target.append(this.element);\r\n\r\n    this.timerId = setTimeout(() => {\r\n      this.remove();\r\n    }, this.duration);\r\n\r\n    NotificationMessage.activeMessage = this;\r\n  }\r\n  remove() {\r\n    clearTimeout(this.timerId);\r\n    if (this.element) this.element.remove();\r\n  }\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    NotificationMessage.activeMessage = null;\r\n  }\r\n}\r\n","export default class SortableList {\r\n  element;\r\n  elementPlaceholder;\r\n  elementDragging;\r\n  _props = {\r\n    shiftDragging: {\r\n      top: 0,\r\n      left: 0,\r\n    },\r\n    posPlaceholder: {\r\n      top: 0,\r\n      left: 0,\r\n    },\r\n    posDragging: {\r\n      top: 0,\r\n      left: 0,\r\n    },\r\n    initialIndex: -1,\r\n    activeIndex: -1,\r\n    isScrolling: false,\r\n    getTranslationDragging(dragging, placeholder) {\r\n      const draggingBox = dragging.getBoundingClientRect();\r\n      const placeholderBox = placeholder.getBoundingClientRect();\r\n      const draggingElem = {\r\n        top: document.documentElement.scrollTop + draggingBox.top,\r\n        left: document.documentElement.scrollLeft + draggingBox.left,\r\n      };\r\n      const placeholderElem = {\r\n        top: document.documentElement.scrollTop + placeholderBox.top,\r\n        left: document.documentElement.scrollLeft + placeholderBox.left,\r\n      };\r\n      return `translate(${draggingElem.left - placeholderElem.left}px,${\r\n        draggingElem.top - placeholderElem.top\r\n      }px)`;\r\n    },\r\n  };\r\n\r\n  scrollIfCloseToWindowEdge = () => {\r\n    if (!this.elementDragging) return;\r\n    const { top } = this._props.posDragging;\r\n    const threshold = 15;\r\n    const documentHeight = document.documentElement.clientHeight;\r\n    const draggingHeight = this.elementDragging.offsetHeight;\r\n\r\n    const topCondition = top < threshold;\r\n    const belowCondition = documentHeight < top + draggingHeight + threshold;\r\n    if (topCondition || belowCondition) {\r\n      if (topCondition) window.scrollBy(0, -2);\r\n      if (belowCondition) window.scrollBy(0, 2);\r\n      this._props.isScrolling = true;\r\n      requestAnimationFrame(this.scrollIfCloseToWindowEdge);\r\n    } else if (this._props.isScrolling) {\r\n      this._props.isScrolling = false;\r\n    }\r\n  };\r\n\r\n  onDragStart = (event) => {\r\n    if (this.elementDragging) return;\r\n    if (event.target.closest(\"[data-grab-handle]\")) {\r\n      event.preventDefault();\r\n      const target = event.target.closest(\"li\");\r\n      const {\r\n        width: tWidth,\r\n        height: tHeight,\r\n        top: tTop,\r\n        left: tLeft,\r\n      } = target.getBoundingClientRect();\r\n\r\n      this._props.shiftDragging = {\r\n        top: event.clientY - tTop,\r\n        left: event.clientX - tLeft,\r\n      };\r\n\r\n      /// placeholder element step\r\n      this.elementPlaceholder.style.cssText = `\r\n        width: ${tWidth}px;\r\n        height: ${tHeight}px;\r\n      `;\r\n      this.elementDragging = target;\r\n      target.replaceWith(this.elementPlaceholder);\r\n\r\n      /// draggable element step\r\n      this.elementDragging.classList.add(\"sortable-list__item_dragging\");\r\n      this.elementDragging.style.cssText = `\r\n        user-select: none;\r\n        top: ${tTop}px;\r\n        left: ${tLeft}px;\r\n        width: ${tWidth}px;\r\n        height: ${tHeight}px;\r\n      `;\r\n\r\n      const { top: pTop, left: pLeft } =\r\n        this.elementPlaceholder.getBoundingClientRect();\r\n\r\n      this._props.posPlaceholder = {\r\n        top: pTop,\r\n        left: pLeft,\r\n      };\r\n\r\n      this.element.append(this.elementDragging);\r\n      this._props.initialIndex = this.getIndex();\r\n      this._props.activeIndex = this._props.initialIndex;\r\n      document.addEventListener(\"pointermove\", this.onDragMove);\r\n      document.addEventListener(\"pointerup\", this.onDragEnd);\r\n    }\r\n  };\r\n  onDragEnd = () => {\r\n    const transformValue = this._props.getTranslationDragging(\r\n      this.elementDragging,\r\n      this.elementPlaceholder\r\n    );\r\n\r\n    this.elementDragging.classList.remove(\"sortable-list__item_dragging\");\r\n    this.elementDragging.style.position = \"relative\";\r\n    this.elementDragging.style.zIndex = 10000;\r\n    this.elementDragging.style.top = \"\";\r\n    this.elementDragging.style.left = \"\";\r\n    this.elementDragging.style.transform = transformValue;\r\n    this.elementDragging.style.transition = \"transform 0.3s ease-in-out\";\r\n    this.elementPlaceholder.replaceWith(this.elementDragging);\r\n\r\n    setTimeout(() => {\r\n      this.elementDragging.style.transform = \"\";\r\n      this._props.isScrolling = false;\r\n      this.elementDragging = null;\r\n    }, 0);\r\n\r\n    document.removeEventListener(\"pointermove\", this.onDragMove);\r\n    document.removeEventListener(\"pointerup\", this.onDragEnd);\r\n    this.elementDragging.addEventListener(\r\n      \"transitionend\",\r\n      this.onTransitionEnd\r\n    );\r\n\r\n    const toggleEvent = new CustomEvent(\"toggle-event\", {\r\n      detail: {\r\n        element: this.element,\r\n        changed: this._props.initialIndex !== this._props.activeIndex,\r\n      },\r\n      bubbles: true,\r\n    });\r\n    this.elementDragging.dispatchEvent(toggleEvent);\r\n  };\r\n  onDragMove = (event) => {\r\n    event.preventDefault();\r\n\r\n    this.elementDragging.style.display = \"none\";\r\n\r\n    const familiarContainer =\r\n      document.elementFromPoint(event.clientX, event.clientY) &&\r\n      document\r\n        .elementFromPoint(event.clientX, event.clientY)\r\n        .closest(\".sortable-list\") === this.element;\r\n\r\n    const underElement = document.elementFromPoint(\r\n      event.clientX,\r\n      event.clientY\r\n    );\r\n\r\n    this.elementDragging.style.display = \"\";\r\n\r\n    if (\r\n      familiarContainer &&\r\n      underElement &&\r\n      underElement.classList.contains(\"sortable-list__item\") &&\r\n      this.elementPlaceholder !== underElement\r\n    ) {\r\n      let { top, left } = underElement.getBoundingClientRect();\r\n      this._props.posPlaceholder = { top, left };\r\n      if (\r\n        this.elementPlaceholder.getBoundingClientRect().top - event.clientY <=\r\n        0\r\n      ) {\r\n        underElement.after(this.elementPlaceholder);\r\n      } else {\r\n        underElement.before(this.elementPlaceholder);\r\n      }\r\n      this._props.activeIndex = this.getIndex();\r\n    }\r\n\r\n    this._props.posDragging = {\r\n      top: event.clientY - this._props.shiftDragging.top,\r\n      left: event.clientX - this._props.shiftDragging.left,\r\n    };\r\n\r\n    this.elementDragging.style.left = `${this._props.posDragging.left}px`;\r\n    this.elementDragging.style.top = `${this._props.posDragging.top}px`;\r\n\r\n    if (!this._props.isScrolling) this.scrollIfCloseToWindowEdge();\r\n  };\r\n  onTransitionEnd = (event) => {\r\n    event.target.removeAttribute(\"style\");\r\n    event.target.removeEventListener(\"transitionend\", this.onTransitionEnd);\r\n  };\r\n  onRemoveItem = (event) => {\r\n    if (event.target.closest(\"[data-delete-handle]\")) {\r\n      event.target.closest(\"li\").remove();\r\n    }\r\n  };\r\n\r\n  getIndex = () => {\r\n    return [...this.element.children].findIndex((item) => {\r\n      return item === this.elementPlaceholder;\r\n    });\r\n  };\r\n\r\n  constructor({ items } = {}) {\r\n    this.items = items;\r\n    this.render();\r\n  }\r\n  get template() {\r\n    const sortList = this.createHTMLElement(`<ul class=\"sortable-list\"></ul>`);\r\n    this.items.forEach((item) => {\r\n      item.classList.add(\"sortable-list__item\");\r\n      sortList.append(item);\r\n    });\r\n    return sortList;\r\n  }\r\n  get placeholder() {\r\n    return this.createHTMLElement(\r\n      `<li class=\"sortable-list__placeholder\"></li>`\r\n    );\r\n  }\r\n  render() {\r\n    this.element = this.template;\r\n    this.elementPlaceholder = this.placeholder;\r\n    this.addEventListeners();\r\n  }\r\n  createHTMLElement(html) {\r\n    const wrapper = document.createElement(\"div\");\r\n    wrapper.innerHTML = html;\r\n    return wrapper.firstElementChild;\r\n  }\r\n  addEventListeners() {\r\n    this.element.addEventListener(\"pointerup\", this.onRemoveItem);\r\n    this.element.addEventListener(\"pointerdown\", this.onDragStart);\r\n  }\r\n  remove() {\r\n    if (this.element) this.element.remove();\r\n  }\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.elementPlaceholder = null;\r\n    this.elementDragging = null;\r\n    this._props = null;\r\n  }\r\n}\r\n","import SortableList from \"../../components/sortable-list/index.js\";\r\nimport fetchJson from \"../../utils/fetch-json.js\";\r\n\r\nconst BACKEND_URL = \"https://course-js.javascript.ru\";\r\n\r\nexport default class Categories {\r\n  element;\r\n  target;\r\n  isLoaded;\r\n  componentIsLoaded = new Promise((resolve) => {\r\n    this.isLoaded = resolve;\r\n  });\r\n\r\n  onToggleData = (event) => {\r\n    this.target = event.target.closest(\".category\");\r\n    if (this.target) {\r\n      const dataList = [...this.target.querySelectorAll(\"li\")].map(\r\n        (item, index) => {\r\n          return { id: item.dataset.id, weight: ++index };\r\n        }\r\n      );\r\n      /*const dataIndex = this.elements.findIndex((item) => {\r\n        return target === item;\r\n      });\r\n      const data = [...this.data[dataIndex].subcategories];\r\n\r\n      this.sortedData = data.sort((a, b) => {\r\n        return dataList.indexOf(a.id) - dataList.indexOf(b.id);\r\n      });\r\n      this.data[dataIndex].subcategories = this.sortedData;*/\r\n      if (event.detail.changed) this.save(dataList);\r\n    }\r\n  };\r\n  constructor({\r\n    urls = {},\r\n    templates = {\r\n      body: ({ id, title }) => {\r\n        return `\r\n            <div class=\"category category_open\" data-id=\"${id}\">\r\n              <header class=\"category__header\">${title}</header>\r\n              <div class=\"category__body\">\r\n                <div data-element=\"list\" class=\"subcategory-list\">\r\n                </div>\r\n              </div>\r\n            </div>\r\n          `;\r\n      },\r\n      row: ({ id, title, count }) => {\r\n        return `\r\n            <li class=\"categories__sortable-list-item sortable-list__item\" data-grab-handle data-id=${id}>\r\n              <strong>${title}</strong>\r\n              <span><b>${count}</b> products</span>\r\n            </li>\r\n          `;\r\n      },\r\n    },\r\n    eventsList = {\r\n      onToggle: (event) => {\r\n        const target = event.target.closest(\".category__header\");\r\n        if (target) {\r\n          const category = target.closest(\".category\");\r\n          category.classList.toggle(\"category_open\");\r\n        }\r\n      },\r\n    },\r\n  } = {}) {\r\n    this.urls = urls;\r\n    this.templates = templates;\r\n    this.eventsList = eventsList;\r\n\r\n    this.render();\r\n    this.events(\"add\");\r\n  }\r\n\r\n  getList(data) {\r\n    const root = document.createElement(\"div\");\r\n\r\n    root.innerHTML = this.templates.body(data);\r\n\r\n    const itemsList = data.subcategories.map((item) => {\r\n      return this.getItem(item);\r\n    });\r\n\r\n    const sortableList = new SortableList({ items: itemsList });\r\n    root.querySelector(\"[data-element]\").append(sortableList.element);\r\n\r\n    return root.firstElementChild;\r\n  }\r\n\r\n  getItem(item) {\r\n    const element = document.createElement(\"div\");\r\n    element.innerHTML = this.templates.row(item);\r\n    return element.firstElementChild;\r\n  }\r\n\r\n  async render() {\r\n    const wrapper = document.createElement(\"div\");\r\n    this.element = wrapper;\r\n\r\n    const data = await fetchJson(new URL(this.urls.categories, BACKEND_URL));\r\n    const elements = data.map((category) => {\r\n      return this.getList(category);\r\n    });\r\n\r\n    wrapper.append(...elements);\r\n    this.isLoaded();\r\n  }\r\n\r\n  async save(data) {\r\n    const url = new URL(this.urls.subcategories, BACKEND_URL);\r\n    try {\r\n      const result = await fetchJson(url, {\r\n        method: \"PATCH\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(data),\r\n      });\r\n      this.dispatchEvent(result);\r\n    } catch (e) {\r\n      this.dispatchEvent(e);\r\n      console.error(e);\r\n    }\r\n  }\r\n\r\n  dispatchEvent(data) {\r\n    let eventString;\r\n    if (!(data instanceof Error)) eventString = \"event-successPost\";\r\n    else eventString = \"event-errorPost\";\r\n\r\n    const event = new CustomEvent(eventString, {\r\n      detail: data,\r\n      bubbles: true,\r\n    });\r\n\r\n    this.target.dispatchEvent(event);\r\n  }\r\n\r\n  events(type) {\r\n    document[`${type}EventListener`](\"pointerup\", this.eventsList.onToggle);\r\n    document[`${type}EventListener`](\"toggle-event\", this.onToggleData);\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n    this.element = null;\r\n    this.target = null;\r\n    this.events(\"remove\");\r\n  }\r\n}\r\n","import Categories from \"../../components/categories/index.js\";\r\nimport Notification from \"../../components/notification/index.js\";\r\n\r\nexport default class Page {\r\n  element;\r\n  subElements = {};\r\n  components = {};\r\n\r\n  initComponents() {\r\n    const categories = new Categories({\r\n      urls: {\r\n        categories: \"api/rest/categories?_sort=weight&_refs=subcategory\",\r\n        subcategories: \"api/rest/subcategories\",\r\n      },\r\n    });\r\n    this.components = {\r\n      categories,\r\n    };\r\n  }\r\n  renderComponents() {\r\n    Object.keys(this.components).forEach((component) => {\r\n      const root = this.subElements[component];\r\n      const { element } = this.components[component];\r\n\r\n      if (element) root.append(element);\r\n    });\r\n  }\r\n\r\n  get template() {\r\n    return `\r\n      <div class=\"categories\">\r\n        <div class=\"content__top-panel\">\r\n          <h1 class=\"page-title\">Categories products</h1>\r\n        </div>\r\n        <div data-element=\"categories\">\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  render() {\r\n    const element = document.createElement(\"div\");\r\n    element.innerHTML = this.template;\r\n    this.element = element.firstElementChild;\r\n    this.subElements = this.getSubElements(this.element);\r\n\r\n    this.initComponents();\r\n    this.renderComponents();\r\n    this.initEventListeners();\r\n\r\n    return this.element;\r\n  }\r\n\r\n  getSubElements(element) {\r\n    const elements = element.querySelectorAll(\"[data-element]\");\r\n\r\n    return [...elements].reduce((acc, subElement) => {\r\n      acc[subElement.dataset.element] = subElement;\r\n\r\n      return acc;\r\n    }, {});\r\n  }\r\n\r\n  initEventListeners() {\r\n    document.addEventListener(\"event-successPost\", () => {\r\n      const notification = new Notification(\r\n        \"Changes have been done successfully\",\r\n        {\r\n          duration: 3000,\r\n          type: \"success\",\r\n        }\r\n      );\r\n      notification.show();\r\n    });\r\n  }\r\n\r\n  remove() {\r\n    if (this.element) this.element.remove();\r\n  }\r\n\r\n  destroy() {\r\n    this.remove();\r\n\r\n    for (const component of Object.values(this.components)) {\r\n      component.destroy();\r\n    }\r\n  }\r\n}\r\n","// same as fetch, but throws FetchError in case of errors\r\n// status >= 400 is an error\r\n// network error / json error are errors\r\nimport Notification from \"../components/notification/index.js\";\r\n\r\nexport default async function (url, params) {\r\n  let response;\r\n\r\n  try {\r\n    // TODO: \"toString\" call needed for correct work of \"jest-fetch-mock\"\r\n    response = await fetch(url.toString(), params);\r\n  } catch (err) {\r\n    throw new FetchError(response, \"Network error has occurred.\");\r\n  }\r\n\r\n  let body;\r\n\r\n  if (!response.ok) {\r\n    let errorText = response.statusText; // Not Found (for 404)\r\n\r\n    try {\r\n      body = await response.json();\r\n\r\n      errorText =\r\n        (body.error && body.error.message) ||\r\n        (body.data && body.data.error && body.data.error.message) ||\r\n        errorText;\r\n    } catch (error) {\r\n      /* ignore failed body */\r\n    }\r\n\r\n    let message = `Error ${response.status}: ${errorText}`;\r\n\r\n    throw new FetchError(response, body, message);\r\n  }\r\n\r\n  try {\r\n    return await response.json();\r\n  } catch (err) {\r\n    throw new FetchError(response, null, err.message);\r\n  }\r\n}\r\n\r\nexport class FetchError extends Error {\r\n  name = \"FetchError\";\r\n\r\n  constructor(response, body, message) {\r\n    super(message);\r\n    this.response = response;\r\n    this.body = body;\r\n  }\r\n}\r\n\r\n// handle uncaught failed fetch through\r\nwindow.addEventListener(\"unhandledrejection\", (event) => {\r\n  if (event.reason instanceof FetchError) {\r\n    ///alert(event.reason.message);\r\n      const notification = new Notification(event.reason.message, {\r\n        duration: 3000,\r\n        type: 'error'\r\n      });\r\n      notification.show();\r\n  }\r\n});\r\n"],"sourceRoot":""}